<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard - GLB Ingenieros</title>
  <style>
    :root{
      --navy1:#001f3f;
      --navy2:#00284d;
      --verde-osc:#006400;
      --verde-agua:#00bfa5;
      --panel-bg: rgba(255,255,255,0.08);
    }
    html,body{height:100%;margin:0}
    body{
      font-family: "Segoe UI", Arial, sans-serif;
      background: linear-gradient(135deg,var(--navy1),var(--navy2));
      color: #e6f7f5;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:20px;
    }

    .panel{
      width:100%;
      max-width:1100px;
      background: var(--panel-bg);
      border: 3px solid var(--verde-osc);
      border-radius:14px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.55);
      padding:28px;
    }

    header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:20px;
      margin-bottom:18px;
    }
    .brand{
      display:flex;
      gap:12px;
      align-items:center;
    }
    .brand .logo{
      width:56px;height:56px;border-radius:8px;
      background:linear-gradient(180deg,var(--verde-osc),#008e7b);
      display:flex;align-items:center;justify-content:center;
      font-weight:bold;color:#fff;
      box-shadow:0 6px 14px rgba(0,0,0,0.4);
    }
    h1{margin:0;font-size:20px;color:var(--verde-agua)}
    .actions{display:flex;gap:10px;align-items:center}
    .btn{
      background: linear-gradient(90deg, var(--verde-osc), #00a896);
      color:white;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600;
      box-shadow: 0 6px 12px rgba(0,0,0,0.25); transition: transform .15s ease, box-shadow .15s ease;
    }
    .btn:hover{transform:translateY(-2px); box-shadow: 0 10px 18px rgba(0,0,0,0.35)}

    .layout{
      display:grid;
      grid-template-columns: 1fr 380px;
      gap:22px;
      align-items:start;
    }

    /* left - main */
    .main{
      min-height:320px;
    }

    .cards{
      display:flex;
      gap:18px;
      flex-wrap:wrap;
      margin-bottom:18px;
    }
    .card{
      background: rgba(255,255,255,0.06);
      border:2px solid rgba(255,255,255,0.06);
      padding:18px;
      border-radius:10px;
      width:calc(33% - 12px);
      min-width:160px;
      cursor:pointer;
      transition: transform .15s ease, background .15s;
      text-align:center;
    }
    .card:hover{transform:translateY(-6px); background: rgba(255,255,255,0.11)}
    .card h3{margin:8px 0;color:#e6fff9}
    .card p{margin:0;color:#bfeee6;font-size:13px}

    /* right - panel */
    aside{
      background: rgba(0,0,0,0.12);
      border-radius:10px;
      padding:16px;
      height:100%;
    }

    .resultado{
      margin-top:12px;
      background: rgba(0,0,0,0.18);
      padding:12px;
      border-radius:8px;
      max-height:420px; overflow:auto;
      font-family: monospace;
      color:#cff7f0;
      font-size:13px;
      white-space:pre-wrap;
    }

    footer{
      margin-top:20px; text-align:right; color:#bfeee6; font-size:13px;
    }

    @media(max-width:920px){
      .layout{grid-template-columns:1fr; margin-top:12px}
      .card{width:48%}
    }
    @media(max-width:520px){
      .card{width:100%}
      .brand h1{font-size:16px}
    }
  </style>
</head>
<body>
  <div class="panel">
    <header>
      <div class="brand">
        <div class="logo">GLB</div>
        <div>
          <h1>GLB Ingenieros</h1>
          <div style="font-size:13px;color:#cfeee7">Panel conectado a Siigo</div>
        </div>
      </div>

      <div class="actions">
        <button class="btn" id="btn-probar">Probar Conexi√≥n</button>
        <button class="btn" id="btn-logout">Cerrar Sesi√≥n</button>
      </div>
    </header>

    <div class="layout">
      <main class="main">
        <div class="cards">
          <div class="card" id="card-clientes"><h3>üë• Clientes</h3><p>Crear / Listar clientes</p></div>
          <div class="card" id="card-productos"><h3>üì¶ Productos</h3><p>Listar productos</p></div>
          <div class="card" id="card-facturas"><h3>üßæ Facturas</h3><p>Crear / Listar facturas</p></div>
        </div>

        <div>
          <h3 style="color:var(--verde-agua); margin-bottom:8px;">Acciones r√°pidas</h3>
          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button class="btn" id="btn-list-clientes">Listar Clientes</button>
            <button class="btn" id="btn-list-productos">Listar Productos</button>
            <button class="btn" id="btn-list-facturas">Listar Facturas</button>
          </div>
        </div>

        <div style="margin-top:18px;">
          <h3 style="color:var(--verde-agua); margin-bottom:8px;">Resultado</h3>
          <div id="resultado" class="resultado">Aqu√≠ aparecer√°n las respuestas de la API.</div>
        </div>
      </main>

      <aside>
        <h3 style="color:var(--verde-agua); margin:0 0 8px 0">Estado</h3>
        <div id="estado" style="font-size:14px; color:#cfeee7">Token: <span id="token-info">sin token</span></div>

        <hr style="margin:12px 0; border-color:rgba(255,255,255,0.06)">

        <div style="font-size:13px; color:#bfeee6">
          <strong>Informaci√≥n:</strong>
          <p style="margin:8px 0 0 0">Usa los botones para listar o crear. Las llamadas se hacen a trav√©s de tus webhooks en n8n.</p>
        </div>
      </aside>
    </div>

    <footer>
      <small>GLB Ingenieros ‚Ä¢ Integraci√≥n Siigo ‚Ä¢ n8n</small>
    </footer>
  </div>

  <script>
    // URLs de tus webhooks n8n
    const W_PRODUCTS = 'https://fabicolorado.app.n8n.cloud/webhook/productos';
    const W_FACTURAS = 'https://fabicolorado.app.n8n.cloud/webhook/facturas';
    const W_CLIENTES  = 'https://fabicolorado.app.n8n.cloud/webhook/clientes';

    const resultadoEl = document.getElementById('resultado');
    const tokenInfo = document.getElementById('token-info');

    // Mostrar token si existe
    function refreshTokenInfo(){
      const t = localStorage.getItem('access_token');
      tokenInfo.textContent = t ? ('guardado (' + (t.slice(0,10)) + '...)') : 'sin token';
    }
    refreshTokenInfo();

    // util: mostrar JSON bonito
    function showJSON(obj){
      resultadoEl.textContent = JSON.stringify(obj, null, 2);
    }

    // Logout
    document.getElementById('btn-logout').addEventListener('click', ()=> {
      localStorage.removeItem('access_token');
      window.location.href = 'index.html';
    });

    // Probar conexi√≥n simple (ejemplo: listar clientes)
    document.getElementById('btn-probar').addEventListener('click', async ()=> {
      const token = localStorage.getItem('access_token');
      if(!token){ resultadoEl.textContent = 'No hay token. Inicia sesi√≥n.'; return; }
      resultadoEl.textContent = 'Comprobando conexi√≥n...';
      try{
        // llamada de ejemplo directa a Siigo (si tu entorno permite). Si no, llamar a n8n
        const resp = await fetch(W_CLIENTES, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ token })
        });
        const data = await resp.json();
        showJSON(data);
      }catch(err){
        resultadoEl.textContent = 'Error al conectar: '+ String(err);
      }
    });

    // Cards click handlers
    document.getElementById('card-productos').addEventListener('click', ()=> document.getElementById('btn-list-productos').click());
    document.getElementById('card-clientes').addEventListener('click', ()=> document.getElementById('btn-list-clientes').click());
    document.getElementById('card-facturas').addEventListener('click', ()=> document.getElementById('btn-list-facturas').click());

    // Listar productos
    document.getElementById('btn-list-productos').addEventListener('click', async ()=>{
      const token = localStorage.getItem('access_token');
      if(!token){ resultadoEl.textContent = 'No hay token. Inicia sesi√≥n.'; return; }
      resultadoEl.textContent = 'Obteniendo productos...';
      try{
        const resp = await fetch(W_PRODUCTS, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ token })
        });
        const data = await resp.json();
        showJSON(data);
      }catch(err){
        resultadoEl.textContent = 'Error: '+ String(err);
      }
    });

    // Listar facturas
    document.getElementById('btn-list-facturas').addEventListener('click', async ()=>{
      const token = localStorage.getItem('access_token');
      if(!token){ resultadoEl.textContent = 'No hay token. Inicia sesi√≥n.'; return; }
      resultadoEl.textContent = 'Obteniendo facturas...';
      try{
        const resp = await fetch(W_FACTURAS, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ action: 'list', token })
        });
        const data = await resp.json();
        showJSON(data);
      }catch(err){
        resultadoEl.textContent = 'Error: '+ String(err);
      }
    });

    // Listar clientes
    document.getElementById('btn-list-clientes').addEventListener('click', async ()=>{
      const token = localStorage.getItem('access_token');
      if(!token){ resultadoEl.textContent = 'No hay token. Inicia sesi√≥n.'; return; }
      resultadoEl.textContent = 'Obteniendo clientes...';
      try{
        const resp = await fetch(W_CLIENTES, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ action: 'list', token })
        });
        const data = await resp.json();
        showJSON(data);
      }catch(err){
        resultadoEl.textContent = 'Error: '+ String(err);
      }
    });

    // refrescar token info en carga
    refreshTokenInfo();
  </script>
</body>
</html>
